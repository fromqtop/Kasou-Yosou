name: Hyperliquid 24h Data Test

on:
  workflow_dispatch:

jobs:
  test_hl:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch 24 hours of 1h Candle from Hyperliquid
        run: |
          # 現在時刻から24時間前（86,400,000ミリ秒前）を計算してデータをリクエスト
          START_TIME=$(python3 -c "import time; print(int(time.time() * 1000) - 86400000)")
          
          curl -X POST https://api.hyperliquid.xyz/info \
          -H "Content-Type: application/json" \
          -d "{
            \"type\": \"candleSnapshot\",
            \"req\": {
              \"coin\": \"BTC\",
              \"interval\": \"1h\",
              \"startTime\": $START_TIME
            }
          }" > response.json
          
          # 結果を表示
          cat response.json
          
          # データの個数を確認（24-25個あれば成功）
          echo "Data count:"
          jq '. | length' response.json